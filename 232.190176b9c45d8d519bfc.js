"use strict";(self.webpackChunkissue3=self.webpackChunkissue3||[]).push([[232],{9944:(e,a,s)=>{s.d(a,{N:()=>i});const i=e=>null==e?void 0:e.reduce(((e,{name:a,code:s})=>(e.push({label:a,value:s}),e)),[])},981:(e,a,s)=>{s.d(a,{Y:()=>i});const i=e=>{var a;return null===(a=Object.entries(e))||void 0===a?void 0:a.reduce(((e,[a,s])=>(e.push({label:s,value:a}),e)),[])}},5736:(e,a,s)=>{s.d(a,{j:()=>i});const i=e=>{const{firstName:a,lastName:s,driverLicense:i,email:o,model:l,autoCategory:n,city:t}=e,{value:r}=n,{value:d}=l,{value:c}=t;return{status:{code:"DRAFT"},person:{firstName:a,lastName:s,driverLicense:i,email:o},auto:{autoCategory:{code:r},model:{code:d}},city:{code:c}}}},8438:(e,a,s)=>{s.r(a),s.d(a,{default:()=>A});var i=s(4848),o=s(6540),l=s(7767),n=s(5749),t=s(7183),r=s(6175),d=s(9785),c=s(1575),p=s(2082),u=s(4555),g=s(4215),v=s(5691),m=s(981),x=s(1920),h=s(8223),j=s(5736),f=s(9944),_=s(2111),b=s(3698),y=s(5549);const N={page__loader:"XO2stcw1",pageLoader:"XO2stcw1",page__label:"Hi7gM6_e",pageLabel:"Hi7gM6_e",page__validation:"ZWZR4Z9H",pageValidation:"ZWZR4Z9H",page__error:"nQA8nhnb",pageError:"nQA8nhnb",page__success:"qBWRqHWJ",pageSuccess:"qBWRqHWJ",page__additional:"AVze99lB",pageAdditional:"AVze99lB"};var O=function(e,a,s,i){return new(s||(s=Promise))((function(o,l){function n(e){try{r(i.next(e))}catch(e){l(e)}}function t(e){try{r(i.throw(e))}catch(e){l(e)}}function r(e){var a;e.done?o(e.value):(a=e.value,a instanceof s?a:new s((function(e){e(a)}))).then(n,t)}r((i=i.apply(e,a||[])).next())}))};const S=({proposal:e,onOpenModalWithLoader:a})=>{var s,r,S,C,E,A,w,L,k,D,R;const V=(0,l.Zp)(),{city:Z,auto:B,id:H}=e,{lastName:I,firstName:W,driverLicense:F,email:M}=e.person,{citiesDictionary:J,autoCategoriesNamesDictionary:T,autoModelsDictionary:X,autoCategoriesDictionary:Y,autoDictionary:G}=(0,t.G)((e=>e.dictionaryReducer)),{register:K,handleSubmit:P,reset:$,control:q,setValue:z,watch:Q,formState:{errors:U,isValid:ee}}=(0,d.mN)({mode:"onChange",resolver:(0,c.t)(x.ye),defaultValues:{lastName:I,firstName:W,driverLicense:F,email:M,autoCategory:{value:B.autoCategory.code,label:Y[B.autoCategory.code]},model:{value:B.model.code,label:X[B.model.code]},city:{value:Z.code,label:J[Z.code]}}}),[ae,se]=(0,o.useState)([]),[ie,oe]=(0,o.useState)(!1),[le,ne]=(0,o.useState)(null),[te,re]=(0,o.useState)(0),[de,{isSuccess:ce,error:pe,isLoading:ue}]=(0,y.nz)(),[ge,{error:ve}]=(0,y.Te)(),me=Q("autoCategory"),[xe,{isLoading:he,isSuccess:je,isError:fe}]=(0,y.W$)();(0,o.useEffect)((()=>{if(void 0!==me&&te>1){const e=T[me.value],a=G[e];z("model",{label:"",value:""}),se((0,f.N)(a)),re((e=>e+1))}else{const e=T[B.autoCategory.code],a=G[e];se((0,f.N)(a)),re((e=>e+1))}}),[me]);const _e=()=>{ne(null),oe(!1)};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(p.l,{className:N.page__form,legend:"Изменить заявку",name:"edit-proposal",submitTitle:"Сохранить",loading:ue,isValid:ee,onSubmit:P((e=>O(void 0,void 0,void 0,(function*(){try{const a=(0,j.j)(e);a.id=+H,yield de(a).unwrap()}catch(e){console.log("Запрос выполнен с ошибкой: "+ +e)}$()})))),children:[(0,i.jsx)("p",{className:N.page__validation,children:null===(s=U.root)||void 0===s?void 0:s.message}),(0,i.jsx)(u.p,Object.assign({},K("firstName"),{type:"text",title:"Имя:",placeholder:"Имя",isValid:void 0===(null===(r=U.firstName)||void 0===r?void 0:r.message)})),(0,i.jsx)("p",{className:N.page__validation,children:null===(S=U.firstName)||void 0===S?void 0:S.message}),(0,i.jsx)(u.p,Object.assign({},K("lastName"),{type:"text",title:"Фамилия:",placeholder:"Фамилия",isValid:void 0===(null===(C=U.lastName)||void 0===C?void 0:C.message)})),(0,i.jsx)("p",{className:N.page__validation,children:null===(E=U.lastName)||void 0===E?void 0:E.message}),(0,i.jsx)(u.p,Object.assign({},K("email"),{type:"email",title:"Email:",placeholder:"Email",isValid:void 0===(null===(A=U.email)||void 0===A?void 0:A.message)})),(0,i.jsx)("p",{className:N.page__validation,children:null===(w=U.email)||void 0===w?void 0:w.message}),(0,i.jsx)(u.p,Object.assign({},K("driverLicense"),{type:"text",title:"Водительское удостоверение:",placeholder:"Водительское удостоверение",isValid:void 0===(null===(L=U.driverLicense)||void 0===L?void 0:L.message)})),(0,i.jsx)("p",{className:N.page__validation,children:null===(k=U.driverLicense)||void 0===k?void 0:k.message}),(0,i.jsx)("p",{className:N.page__label,children:"Выберите город:"}),(0,i.jsx)(d.xI,{name:"city",control:q,render:({field:e})=>(0,i.jsx)(g.Ay,Object.assign({},e,{styles:h.K,classNamePrefix:N.page__select,placeholder:"Выберите город",options:(0,m.Y)(J)}))}),(0,i.jsx)("p",{className:N.page__label,children:"Выберите марку автомобиля:"}),(0,i.jsx)(d.xI,{name:"autoCategory",control:q,render:({field:e})=>(0,i.jsx)(g.Ay,Object.assign({},e,{styles:h.K,placeholder:"Выберите марку автомобиля",options:(0,m.Y)(Y)}))}),(0,i.jsx)("p",{className:N.page__label,children:"Выберите модель автомобиля:"}),(0,i.jsx)(d.xI,{name:"model",control:q,render:({field:e})=>(0,i.jsx)(g.Ay,Object.assign({},e,{styles:h.K,placeholder:"Выберите модель автомобиля",options:ae}))}),(0,i.jsx)("p",{className:N.page__validation,children:null===(R=null===(D=U.model)||void 0===D?void 0:D.label)||void 0===R?void 0:R.message}),ue&&(0,i.jsx)(v.a,{className:N.page__loader}),void 0!==pe&&(0,i.jsxs)("p",{className:N.page__error,children:["Запрос выполнен с ошибкой: ",+pe]}),void 0!==ve&&(0,i.jsxs)("p",{className:N.page__error,children:["Запрос выполнен с ошибкой: ",+ve]}),ce&&(0,i.jsx)("p",{className:N.page__success,children:"Заявка успешно изменена!"})]}),(0,i.jsx)(b.$,{className:N.menu__link,onClick:()=>O(void 0,void 0,void 0,(function*(){yield(e=>O(void 0,void 0,void 0,(function*(){try{yield ge(e).unwrap(),a()}catch(e){console.log(e)}})))(H)})),theme:ee?b.o.SUCCESS:b.o.DISABLED,disabled:!ee,children:"Отправить на рассмотрение"}),(0,i.jsx)(b.$,{className:N.menu__link,onClick:()=>{(e=>{ne(e),oe(!0)})(H)},theme:b.o.DELETE,children:"Удалить"}),(0,i.jsxs)(_.a,{isOpen:ie,onClose:_e,isSuccess:je,isError:fe,isLoading:he,children:[(0,i.jsxs)("p",{className:N.page__info,children:["Вы точно уверены, что хотите удалить заявку под номером ",null!=le?le:""," ? Отменить действие  будет невозможно"]}),(0,i.jsx)(b.$,{theme:b.o.DELETE,onClick:()=>O(void 0,void 0,void 0,(function*(){yield(e=>O(void 0,void 0,void 0,(function*(){try{yield xe(e).unwrap(),V(n.AY.proposals,{replace:!0})}catch(e){console.log(e)}})))(H)})),children:"Удалить"}),(0,i.jsx)(b.$,{theme:b.o.SECONDARY,onClick:_e,children:"Отмена"})]})]})},C=(e,a)=>a.find((a=>a.id===+e)),E={page:"ZgD9KHRi",page__loader:"uQa7y7kj",pageLoader:"uQa7y7kj",page__validation:"XyA0Fsgd",pageValidation:"XyA0Fsgd",page__error:"G9mIwe1Z",pageError:"G9mIwe1Z",page__success:"dSASFXjt",pageSuccess:"dSASFXjt",page__additional:"eMHpRjsb",pageAdditional:"eMHpRjsb"};function A(){var e;const a=(0,l.Zp)(),{id:s}=(0,l.g)(),{allProposals:d}=(0,t.G)((e=>e.proposalsReducer)),[c,p]=(0,o.useState)(null),[u,g]=(0,o.useState)(!1),[v]=(0,y.bv)(),[m,{isError:x,data:h}]=(0,y.uj)({pollingInterval:5e3,skipPollingIfUnfocused:!0});return(0,o.useEffect)((()=>{if(d.length>0&&void 0!==s){const e=C(+s,d);void 0!==e?p(e):a(n.AY["not-found"],{replace:!0})}}),[d]),(0,o.useEffect)((()=>{null!==c&&"PENDING"===c.status.code&&m(c.id).unwrap().catch((e=>{console.log(e)}))}),[c]),(0,o.useEffect)((()=>{if(null!==c){const e=c.status.code;h!==e&&v(c.id).unwrap().catch((e=>{console.log(e)})).finally((()=>{g(!1)}))}}),[h]),(0,i.jsxs)("main",{className:E.page,children:["DRAFT"===(null===(e=null==c?void 0:c.status)||void 0===e?void 0:e.code)?(0,i.jsx)(S,{proposal:c,onOpenModalWithLoader:()=>{g(!0)}}):null!==c&&(0,i.jsx)(r.pm,{proposal:c}),x&&(0,i.jsx)("p",{className:E.page__error,children:"Во время выполнения запроса произошла ошибка"}),(0,i.jsx)(_.a,{isOpen:u,onClose:()=>{g(!1)},isSuccess:!1,isError:!1,isLoading:!0,children:(0,i.jsx)("p",{className:E.page__success,children:"Заявка рассматривается"})})]})}},8223:(e,a,s)=>{s.d(a,{K:()=>i});const i={container:e=>Object.assign(Object.assign({},e),{width:"100%"}),control:e=>Object.assign(Object.assign({},e),{padding:"18px 24px",boxSizing:"border-box",width:"100%",display:"flex",font:"400 16px/24px 'JetBrains', arial, sans-serif",color:"#8585ad",backgroundColor:"var(--color-interface-input)",border:"2px dashed #4c4cff",borderRadius:"40px",boxShadow:"none"}),placeholder:e=>Object.assign(Object.assign({},e),{color:"var(--color-text-primary-light-text)",font:"400 16px/24px 'JetBrains', arial, sans-serif"}),singleValue:e=>Object.assign(Object.assign({},e),{color:"var(--color-text-primary-light-text)",font:"400 16px/24px 'JetBrains', arial, sans-serif"}),menu:e=>Object.assign(Object.assign({},e),{color:"#8585ad",font:"400 16px/24px 'JetBrains', arial, sans-serif",borderRadius:"40px",backgroundColor:"#2f2f37",border:"2px dashed #4c4cff",overflow:"hidden"}),option:e=>Object.assign(Object.assign({},e),{padding:"10px 20px",cursor:"pointer",textAlign:"center",transition:"all .6 ease"})}}}]);